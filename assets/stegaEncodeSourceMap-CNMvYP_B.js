var B=Object.defineProperty,Q=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var A=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,P=(e,t)=>{for(var r in t||(t={}))Z.call(t,r)&&A(e,r,t[r]);if(x)for(var r of x(t))v.call(t,r)&&A(e,r,t[r]);return e},j=(e,t)=>Q(e,Y(t));import{i as T,C as g}from"./index-CyT7XgmJ.js";const N=/_key\s*==\s*['"](.*)['"]/;function tt(e){return typeof e=="string"?N.test(e.trim()):typeof e=="object"&&"_key"in e}function V(e){if(!Array.isArray(e))throw new Error("Path is not an array");return e.reduce((t,r,i)=>{const n=typeof r;if(n==="number")return`${t}[${r}]`;if(n==="string")return`${t}${i===0?"":"."}${r}`;if(tt(r)&&r._key)return`${t}[_key=="${r._key}"]`;if(Array.isArray(r)){const[s,o]=r;return`${t}[${s}:${o}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(r)}\``)},"")}const U={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},O={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function et(e){return`$${e.map(t=>typeof t=="string"?`['${t.replace(/[\f\n\r\t'\\]/g,r=>U[r])}']`:typeof t=="number"?`[${t}]`:t._key!==""?`[?(@._key=='${t._key.replace(/['\\]/g,r=>U[r])}')]`:`[${t._index}]`).join("")}`}function D(e){const t=[],r=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let i;for(;(i=r.exec(e))!==null;){if(i[1]!==void 0){const n=i[1].replace(/\\(\\|f|n|r|t|')/g,s=>O[s]);t.push(n);continue}if(i[2]!==void 0){t.push(parseInt(i[2],10));continue}if(i[3]!==void 0){const n=i[3].replace(/\\(\\')/g,s=>O[s]);t.push({_key:n,_index:-1});continue}}return t}function M(e){return e.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._key!=="")return{_key:t._key};if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function nt(e){return e.map(t=>{if(typeof t=="string"||typeof t=="number")return t;if(t._index!==-1)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function rt(e,t){if(!(t!=null&&t.mappings))return;const r=et(nt(e));if(t.mappings[r]!==void 0)return{mapping:t.mappings[r],matchedPath:r,pathSuffix:""};const i=Object.entries(t.mappings).filter(([c])=>r.startsWith(c)).sort(([c],[f])=>f.length-c.length);if(i.length==0)return;const[n,s]=i[0],o=r.substring(n.length);return{mapping:s,matchedPath:n,pathSuffix:o}}function it(e){return e!==null&&Array.isArray(e)}function $(e,t,r=[]){if(it(e))return e.map((i,n)=>{if(T(i)){const s=i._key;if(typeof s=="string")return $(i,t,r.concat({_key:s,_index:n}))}return $(i,t,r.concat(n))});if(T(e)){if(e._type==="block"||e._type==="span"){const i=P({},e);return e._type==="block"?i.children=$(e.children,t,r.concat("children")):e._type==="span"&&(i.text=$(e.text,t,r.concat("text"))),i}return Object.fromEntries(Object.entries(e).map(([i,n])=>[i,$(n,t,r.concat(i))]))}return t(e,r)}function ot(e,t,r){return $(e,(i,n)=>{if(typeof i!="string")return i;const s=rt(n,t);if(!s)return i;const{mapping:o,matchedPath:c}=s;if(o.type!=="value"||o.source.type!=="documentValue")return i;const f=t.documents[o.source.document],u=t.paths[o.source.path],h=D(c),l=D(u).concat(n.slice(h.length));return r({sourcePath:l,sourceDocument:f,resultPath:n,value:i})})}const st="drafts",at="versions",m=".",q=`${st}${m}`,pt=`${at}${m}`;function J(e){return e.startsWith(q)}function R(e){return e.startsWith(pt)}function ct(e){return!J(e)&&!R(e)}function dt(e){if(!R(e))return;const[t,r,...i]=e.split(m);return r}function ft(e){return R(e)?e.split(m).slice(2).join(m):J(e)?e.slice(q.length):e}function ut(e){const{baseUrl:t,workspace:r="default",tool:i="default",id:n,type:s,path:o,projectId:c,dataset:f}=e;if(!t)throw new Error("baseUrl is required");if(!o)throw new Error("path is required");if(!n)throw new Error("id is required");if(t!=="/"&&t.endsWith("/"))throw new Error("baseUrl must not end with a slash");const u=r==="default"?void 0:r,h=i==="default"?void 0:i,l=ft(n),k=Array.isArray(o)?V(M(o)):o,d=new URLSearchParams({baseUrl:t,id:l,type:s,path:k});if(u&&d.set("workspace",u),h&&d.set("tool",h),c&&d.set("projectId",c),f&&d.set("dataset",f),ct(n))d.set("perspective","published");else if(R(n)){const E=dt(n);d.set("perspective",E)}const y=[t==="/"?"":t];u&&y.push(u);const w=["mode=presentation",`id=${l}`,`type=${s}`,`path=${encodeURIComponent(k)}`];return h&&w.push(`tool=${h}`),y.push("intent","edit",`${w.join(";")}?${d}`),y.join("/")}function ht(e){let t=typeof e=="string"?e:e.baseUrl;return t!=="/"&&(t=t.replace(/\/$/,"")),typeof e=="string"?{baseUrl:t}:j(P({},e),{baseUrl:t})}const L=({sourcePath:e,resultPath:t,value:r})=>{if(yt(r)||$t(r))return!1;const i=e.at(-1);return!(e.at(-2)==="slug"&&i==="current"||typeof i=="string"&&(i.startsWith("_")||i.endsWith("Id"))||e.some(n=>n==="meta"||n==="metadata"||n==="openGraph"||n==="seo")||W(e)||W(t)||typeof i=="string"&&lt.has(i))},lt=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);function yt(e){return/^\d{4}-\d{2}-\d{2}/.test(e)?!!Date.parse(e):!1}const _t=new Set(["app:","data:","discord:","file:","ftp:","ftps:","geo:","http:","https:","imap:","javascript:","magnet:","mailto:","maps:","ms-excel:","ms-powerpoint:","ms-word:","slack:","sms:","spotify:","steam:","teams:","tel:","vscode:","zoom:"]);function $t(e){try{const{protocol:t}=new URL(e,e.startsWith("/")?"https://acme.com":void 0);return _t.has(t)||t.startsWith("web+")}catch(t){return!1}}function W(e){return e.some(t=>typeof t=="string"&&t.match(/type/i)!==null)}const S=20;function kt(e,t,r){var f,u,h,l,k,d,y,w,E;const{filter:i,logger:n,enabled:s}=r;if(!s){const a="config.enabled must be true, don't call this function otherwise";throw(f=n==null?void 0:n.error)==null||f.call(n,`[@sanity/client]: ${a}`,{result:e,resultSourceMap:t,config:r}),new TypeError(a)}if(!t)return(u=n==null?void 0:n.error)==null||u.call(n,"[@sanity/client]: Missing Content Source Map from response body",{result:e,resultSourceMap:t,config:r}),e;if(!r.studioUrl){const a="config.studioUrl must be defined";throw(h=n==null?void 0:n.error)==null||h.call(n,`[@sanity/client]: ${a}`,{result:e,resultSourceMap:t,config:r}),new TypeError(a)}const o={encoded:[],skipped:[]},c=ot(e,t,({sourcePath:a,sourceDocument:_,resultPath:b,value:p})=>{if((typeof i=="function"?i({sourcePath:a,resultPath:b,filterDefault:L,sourceDocument:_,value:p}):L({sourcePath:a,resultPath:b,value:p}))===!1)return n&&o.skipped.push({path:C(a),value:`${p.slice(0,S)}${p.length>S?"...":""}`,length:p.length}),p;n&&o.encoded.push({path:C(a),value:`${p.slice(0,S)}${p.length>S?"...":""}`,length:p.length});const{baseUrl:I,workspace:F,tool:z}=ht(typeof r.studioUrl=="function"?r.studioUrl(_):r.studioUrl);if(!I)return p;const{_id:G,_type:H,_projectId:K,_dataset:X}=_;return g(p,{origin:"sanity.io",href:ut(P({baseUrl:I,workspace:F,tool:z,id:G,type:H,path:a},!r.omitCrossDatasetReferenceData&&{dataset:X,projectId:K}))},!1)});if(n){const a=o.skipped.length,_=o.encoded.length;if((a||_)&&((l=(n==null?void 0:n.groupCollapsed)||n.log)==null||l("[@sanity/client]: Encoding source map into result"),(k=n.log)==null||k.call(n,`[@sanity/client]: Paths encoded: ${o.encoded.length}, skipped: ${o.skipped.length}`)),o.encoded.length>0&&((d=n==null?void 0:n.log)==null||d.call(n,"[@sanity/client]: Table of encoded paths"),(y=(n==null?void 0:n.table)||n.log)==null||y(o.encoded)),o.skipped.length>0){const b=new Set;for(const{path:p}of o.skipped)b.add(p.replace(N,"0").replace(/\[\d+\]/g,"[]"));(w=n==null?void 0:n.log)==null||w.call(n,"[@sanity/client]: List of skipped paths",[...b.values()])}(a||_)&&((E=n==null?void 0:n.groupEnd)==null||E.call(n))}return c}function C(e){return V(M(e))}var mt=Object.freeze({__proto__:null,stegaEncodeSourceMap:kt});export{ot as encodeIntoResult,kt as stegaEncodeSourceMap,mt as stegaEncodeSourceMap$1};
